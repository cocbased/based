<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>B•A•S•E•D</title>

  <link rel="apple-touch-icon" href="icon-180.png" />
  <link rel="manifest" href="manifest.json" />

  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />

  <style>
    body {
      margin: 0;
      background: #000;
      color: #fff;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 24px 16px;
      box-sizing: border-box;
      text-align: center;
    }

    .app-icon {
      width: 120px;
      height: 120px;
      margin-bottom: 12px;
      border-radius: 24px;
      object-fit: contain;
    }

    .logo {
      width: 100%;
      max-width: 300px;
      margin-bottom: 16px;
      object-fit: contain;
    }

    .subtitle {
      margin-bottom: 24px;
      font-size: 14px;
      opacity: 0.7;
    }

    .timers {
      width: 100%;
      max-width: 340px;
      padding: 12px 16px;
      border-radius: 12px;
      background: #0b1829;
      border: 1px solid #2b3b55;
      text-align: left;
      margin-bottom: 24px;
    }

    .timers-title {
      text-align: center;
      font-size: 16px;
      margin-bottom: 8px;
    }

    .section-title {
      text-align: center;
      font-size: 13px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      opacity: 0.75;
      margin: 12px 0 6px;
    }

    .divider {
      height: 1px;
      background: rgba(255,255,255,0.12);
      margin: 12px 0;
    }

    /* -------- CURRENT WAR BOARD -------- */

    .war-board {
      text-align: center;
      margin-top: 4px;
    }

    .war-timer {
      font-family: monospace;
      font-weight: 800;
      font-size: 14px;
      margin-bottom: 12px;
    }

    .war-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .war-name {
      font-weight: 700;
      font-size: 13px;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      margin-bottom: 6px;
    }

    .war-stat {
      font-family: monospace;
      font-weight: 800;
      font-size: 14px;
      margin-bottom: 4px;
    }

    .war-substat {
      font-family: monospace;
      font-weight: 800;
      font-size: 14px;
      opacity: 0.9;
    }

    /* -------- BUTTONS -------- */

    .button-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
      width: 100%;
      max-width: 280px;
    }

    button {
      padding: 12px;
      font-size: 16px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: #fff;
      color: #000;
    }

    .install-button {
      background: #ffcc00;
      font-weight: bold;
      border-radius: 8px;
    }

    .last-update-footer {
      margin-top: 16px;
      font-size: 12px;
      opacity: 0.75;
    }
  </style>

  <script>
    function openLink(url){ window.location.href = url; }

    function pad(n){ return n.toString().padStart(2,"0"); }

    function formatCountdown(ms){
      if(ms<=0) return "Active now";
      const s=Math.floor(ms/1000);
      const d=Math.floor(s/86400);
      const h=Math.floor((s%86400)/3600);
      const m=Math.floor((s%3600)/60);
      const sec=s%60;
      return `${d}d ${pad(h)}h ${pad(m)}m ${pad(sec)}s`;
    }

    function setText(id,text){
      const el=document.getElementById(id);
      if(el) el.textContent=text;
    }

    // -------- WAR DATA --------

    let warData=null, warFetched=false;

    async function fetchWarData(){
      try{
        const r=await fetch("war.json?cb="+Date.now(),{cache:"no-store"});
        warData=r.ok?await r.json():null;
      }catch(e){ warData=null; }
      warFetched=true;
      renderWar();
    }

    function renderWar(){
      if(!warFetched || !warData || warData.state==="notInWar"){
        setText("war-timer","No war started");
        return;
      }

      setText("war-name-us", warData.ourName || "US");
      setText("war-name-opp", warData.oppName || "OPPONENT");

      const team=warData.teamSize||0;
      const max=team*3;

      setText("war-stars-us", `${warData.ourStars}/${max} ⭐`);
      setText("war-stars-opp", `${warData.oppStars}/${max} ⭐`);

      setText("war-attacks-us", `${warData.ourAttacksRemaining}/${team} ⚔️`);
      setText("war-attacks-opp", `${warData.oppAttacksRemaining}/${team} ⚔️`);
    }

    function updateWarTimer(){
      if(!warData || !warData.warEndIso){
        setText("war-timer","No war started");
        return;
      }
      const end=new Date(warData.warEndIso);
      const now=new Date();
      setText("war-timer", now>=end?"War ended":formatCountdown(end-now));
    }

    fetchWarData();
    setInterval(fetchWarData,60000);
    setInterval(updateWarTimer,1000);
  </script>
</head>

<body>
  <img src="icontransparent.png" class="app-icon" />
  <img src="logo.png" class="logo" />
  <p class="subtitle">EST DECEMBER 2023</p>

  <div class="timers">
    <h2 class="timers-title">Clan Overview</h2>

    <div class="section-title">Current War</div>

    <div class="war-board">
      <div id="war-timer" class="war-timer">Loading…</div>

      <div class="war-grid">
        <div>
          <div id="war-name-us" class="war-name">BASED</div>
          <div id="war-stars-us" class="war-stat">—</div>
          <div id="war-attacks-us" class="war-substat">—</div>
        </div>

        <div>
          <div id="war-name-opp" class="war-name">OPPONENT</div>
          <div id="war-stars-opp" class="war-stat">—</div>
          <div id="war-attacks-opp" class="war-substat">—</div>
        </div>
      </div>
    </div>
  </div>

  <div class="button-container">
    <button onclick="openLink('https://docs.google.com/spreadsheets/d/e/2PACX-1vQJyBeqDwShAcLD0GMnIvNehs8P9eG3ApO6pltrMHe01bZVJn0k3bIxLobnjBpvqEQNDe_sFcRkZPE8/pubhtml')">CWL Leaderboards</button>
    <button onclick="openLink('https://discord.gg/8P96687dPr')">Clan Discord</button>
    <button onclick="openLink('https://link.clashofclans.com/en/?action=OpenClanProfile&tag=2QQYJC08Y')">Visit B•A•S•E•D</button>
    <button class="install-button" onclick="openLink('https://www.youtube.com/watch?v=gIC30U39zpA')">How to install B•A•S•E•D App</button>
  </div>

  <div class="last-update-footer">Auto-updating</div>
</body>
</html>
